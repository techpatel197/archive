trigger:
- main  # Change this to your default branch

pool:
  vmImage: 'ubuntu-latest'

variables:
  imageName: 'your-docker-image-name'  # Change this to your desired image name

jobs:
- job: BuildAndTest
  displayName: 'Build, Test, and Analyze .NET Code'
  container:
    image: 'mcr.microsoft.com/dotnet/sdk:6.0'  # Use the appropriate .NET SDK version
  steps:
  - checkout: self

  - script: |
      echo "Installing Node.js..."
      curl -fsSL https://deb.nodesource.com/setup_16.x | bash -  # Change to the desired Node.js version
      apt-get install -y nodejs

  - script: |
      echo "Installing Gemini CLI..."
      curl -sSL https://get.gemini.com/cli | bash  # Adjust the installation command as necessary


  - script: |
      echo "Building the .NET project..."
      dotnet build dataarchaive.sln  # Change to your solution file

  - script: |
      echo "Running code analysis with Gemini CLI..."
      gemini analyze dataarchaive.sln  # Adjust as necessary for your project
    env:
      GEMINI_API_KEY: AIzaSyBhQc_CUHs3EGpo2nzkEStTVXTrLP30cIg  # Ensure you have this variable set in your pipeline variables

  - script: |
      echo "Building Docker image..."
      docker build -t $(imageName) .
